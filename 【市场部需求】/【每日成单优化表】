select tel_num, source, from_unixtime(create_time) as source_time, 
from_unixtime(order_time) as order_time, planner_name,
 money, original_money, result_table.lesson_num, result_table.free_lesson_num,student_grade, 
 note, max(result_table.create_time) 
from 
(
select *
from 
(select user_online.`telephone_num` as tel_num, series_order.planner_name, 
	case when series_order_course.grade =1 then '一年级'
	     when series_order_course.grade =2 then '二年级'
	     when series_order_course.grade =3 then '三年级'
	     when series_order_course.grade =4 then '四年级'
	     when series_order_course.grade =5 then '五年级'
	     when series_order_course.grade =6 then '六年级'
	     when series_order_course.grade =7 then '初一'
	     when series_order_course.grade =8 then '初二'
	     when series_order_course.grade =9 then '初三'
	     when series_order_course.grade =10 then '小学'
	     when series_order_course.grade =11 then '高一'
	     when series_order_course.grade =12 then '高二'
	     when series_order_course.grade =13 then '高三'
	     when series_order_course.grade =101 then '一年级'
	     when series_order_course.grade =102 then '二年级'
	     when series_order_course.grade =103 then '三年级'
	     when series_order_course.grade =104 then '四年级'
	     when series_order_course.grade =105 then '五年级'
	     when series_order_course.grade =106 then  '六年级'
	     else '其他'
	     end as student_grade,
	series_order.amount/100 as money, series_order_course.original_amount/100 as original_money, 
	series_order_course.lesson_num, series_order_course.free_lesson_num, 
	series_order.`update_time` as order_time, series_order.note

from  user_online 
left join series_order 
on user_online.`user_id` = series_order.`student_user_id` 
left join series_order_course
on series_order.pid=series_order_course.series_order_id
where series_order.status ='SUCCESS' and  series_order.amount/100>100  
and from_unixtime(series_order.update_time)  >= '2018-03-03'
and from_unixtime(series_order.update_time)  < '2018-12-10') order_table
left join
crm_form_record 
on order_table.tel_num = crm_form_record.`telephone_number` and order_table.order_time > crm_form_record.create_time
# where crm_form_record.`telephone_number` != 'NULL'
# group by crm_form_record.source, crm_form_record.create_time
order by crm_form_record.create_time desc  # 使用desc是最后一个渠道，不适用desc是第一个渠道
# order by order_table.order_time desc
) 
as result_table
group by result_table.tel_num, result_table.order_time
order by result_table.order_time desc
